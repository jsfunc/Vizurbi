debug_mode=true;activeRouteColor="#4f8598";inactiveRouteColor="#a9c5d0";activeRouteCheckColor="#FF9100";inactiveRouteCheckColor="#a9c5d0";function desactivateUnlinkedStops(){for(var a=0;a<stops.length;a++){if(stops[a].subRoutes.length==0){stops[a].isActive=false;if(stops[a].circle){stops[a].circle.setStyle({opacity:0,fillOpacity:0})}}}}function disactivateRoute(b){isActiveRoute[b]=false;activeRouteSpans[b].css({"background-color":inactiveRouteCheckColor});for(var a in routes[b].subRoutes){shapes[subRoutes[routes[b].subRoutes[a]].shapeId].polyline.setStyle({color:inactiveRouteColor})}}function activateRoute(b){isActiveRoute[b]=true;activeRouteSpans[b].css({"background-color":activeRouteCheckColor});for(var a in routes[b].subRoutes){shapes[subRoutes[routes[b].subRoutes[a]].shapeId].polyline.setStyle({color:activeRouteColor})}}function toggleRouteActivity(a){isActiveRoute[a]?disactivateRoute(a):activateRoute(a);computeShortestPath();drawAccessible()}function disactivateAllLines(){for(var a=0;a<routes.length;a++){disactivateRoute(a)}computeShortestPath();drawAccessible()}function activateAllLines(){for(var a=0;a<routes.length;a++){activateRoute(a)}computeShortestPath();drawAccessible()}function disactivateBusLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==3){disactivateRoute(a)}}computeShortestPath();drawAccessible()}function activateBusLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==3){activateRoute(a)}}computeShortestPath();drawAccessible()}function disactivateSubwayLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==1){disactivateRoute(a)}}computeShortestPath();drawAccessible()}function activateSubwayLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==1){activateRoute(a)}}computeShortestPath();drawAccessible()}function disactivateTramwayLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==0){disactivateRoute(a)}}computeShortestPath();drawAccessible()}function activateTramwayLines(){for(var a=0;a<routes.length;a++){if(routes[a].type==0){activateRoute(a)}}computeShortestPath();drawAccessible()}var basicMode=true;function toggleAdvancedMode(){if(debug_mode){console.log("In toggleAdvancedMode()")}var a=document.getElementById("advancedbutton");var b=document.getElementById("buttonsadv");var c=document.getElementById("controladv");if(!basicMode){setCookie("mode","basic");if(debug_mode){console.log("advancedMode off")}a.innerHTML="Vers mode avancÃ©";b.style.display="none";c.style.display="none";basicMode=true}else{setCookie("mode","advanced");if(debug_mode){console.log("advancedMode on")}a.innerHTML="Vers mode simple";b.style.display="inline";c.style.display="inline";basicMode=false}}var continueVehicleMovie=true;var vehicleMovieOn=false;function toggleVehicleMovie(){var a=document.getElementById("vehicleMovie");if(vehicleMovieOn){a.innerHTML="Le ballet des bus";continueVehicleMovie=false}else{a.innerHTML="Arr&ecirc;ter le ballet";continueVehicleMovie=true;vehicleMovie()}}filmOn=0;function toggleDayMovie(){var a=document.getElementById("vid");if(filmOn==0){a.innerHTML="Arr&ecirc;ter l'animation";dayMovie();filmOn=1}else{a.innerHTML="Au fil de la journ&eacute;e";continueDayMovie=false;filmOn=0}}function reset(){if(debug_mode){var b=performance.now()}for(var a=0;a<stops.length;a++){stops[a].circle.setStyle({fillColor:inactiveNodeColor,fillOpacity:0.5})}if(debug_mode){console.log("Reset: "+(performance.now()-b))}}function dayMovie(){continueDayMovie=true;var b=startHour;var c=1/60;function a(){startHour+=c;$("#startHour").val(real2hour(startHour));computeShortestPath();drawAccessible();if(startHour<25&&continueDayMovie){setTimeout(a,sleepDelay)}else{$("#slider-hour-vertical").slider("value",startHour)}}a();startHour=b;computeShortestPath();drawAccessible()}function affVehicles(m,h){for(var k=0;k<m.serviceIds.length;k++){if(isOn(services[m.serviceIds[k]],date)&&m.timeTable[k][0]<h){if(isFinite(m.frequencies[k].freq)){var d=m.timeTable[k][m.timeTable[k].length-1]-m.timeTable[k][0];if(h<m.frequencies[k].endTime+d){for(var q=0;(m.timeTable[k][0]+q<=m.frequencies[k].endTime+1/3600)&&(m.timeTable[k][0]+q<h);q+=m.frequencies[k].freq){var g=1;for(;g<m.stops.length;++g){if(m.timeTable[k][g]+q>h){break}}if(g<m.stops.length){var r=g-1;while(m.timeTable[k][r-1]==m.timeTable[k][r]){--r}var o=stops[m.stops[r]].subRoutes[m.id].posInShape;var n=stops[m.stops[g]].subRoutes[m.id].posInShape;var e=shapes[m.shapeId].stops[o];if(n>o){var f=(m.timeTable[k][g]-m.timeTable[k][r]);var l=o+Math.floor((n-o)*(h-(m.timeTable[k][r]+q))/f);var c=m.timeTable[k][r]+q+(l-o)/(n-o)*f;e=interpolatePoint(shapes[m.shapeId].stops[l],shapes[m.shapeId].stops[l+1],(h-c)/f*(n-o))}vehicles.addLayer(L.circleMarker(e,{color:"black",opacity:1,radius:4,stroke:false,fillOpacity:1,clickable:false}))}}}}else{var g=1;for(;g<m.stops.length;++g){if(m.timeTable[k][g]>h){break}}if(g<m.stops.length){var r=g-1;while(m.timeTable[k][r-1]==m.timeTable[k][r]){--r}var o=stops[m.stops[r]].subRoutes[m.id].posInShape;var n=stops[m.stops[g]].subRoutes[m.id].posInShape;var e=shapes[m.shapeId].stops[o];if(n>o){var f=(m.timeTable[k][g]-m.timeTable[k][r]);var l=o+Math.floor((n-o)*(h-m.timeTable[k][r])/f);var c=m.timeTable[k][r]+(l-o)/(n-o)*f;e=interpolatePoint(shapes[m.shapeId].stops[l],shapes[m.shapeId].stops[l+1],(h-c)/f*(n-o))}vehicles.addLayer(L.circleMarker(e,{color:"black",opacity:1,radius:4,stroke:false,fillOpacity:1,clickable:false}))}}}}}function affActiveVehicles(a){vehicles.clearLayers();for(var b=0;b<subRoutes.length;b++){if(isActiveRoute[subRoutes[b].routeId]){affVehicles(subRoutes[b],a)}}}function vehicleMovie(){var c=0.1/60;vehicleMovieOn=true;continueVehicleMovie=true;var b=startHour;function a(){b+=c;$("#startHour").val(real2hour(b));affActiveVehicles(b);if(continueVehicleMovie){setTimeout(a,sleepDelay)}else{vehicles.clearLayers();vehicleMovieOn=false;startHour=b;$("#slider-hour-vertical").slider("value",startHour);$("#startHour").val(real2hour(startHour))}}a()}function interpolatePoint(c,b,a){return(new L.LatLng((1-a)*c.lat+a*b.lat,(1-a)*c.lng+a*b.lng))};