var basicMode=true;debug_mode=true;activeRouteCheckColor="#FF9100";function createControls(){if(debug_mode){console.log("starting createControls...")}initVariables();md=new Date();mh=md.getHours()+md.getMinutes()/60;$("#slider-minute-vertical").slider({orientation:"vertical",range:"min",min:1,max:75,value:30,change:function(e,f){$("#maxMinute").val(f.value+" mn");changeMaxMinute()},slide:function(e,f){$("#maxMinute").val(f.value+" mn")}});$("#maxMinute").val($("#slider-minute-vertical").slider("value")+" mn");$("#slider-hour-vertical").slider({orientation:"vertical",range:"min",min:2,max:25.5,value:mh,step:1/60,change:changeStartHour,slide:function(e,f){$("#startHour").val(real2hour(Number(f.value)))}});$("#startHour").val(real2hour(mh));$("#slider-animation-velocity").slider({range:"min",min:0,max:100,value:50,change:changeAnimationVelocity,slide:changeAnimationVelocity});sleepDelay=1000*Math.exp(-5/100*50);$("#datepicker").datepicker({firstDay:1,dateFormat:"dd/mm/yy",onSelect:changeDate}).datepicker("setDate",new Date());var a=new Array;var c=new Array;for(var b=0;b<stops.length;b++){if(stops[b].isActive){var d=b;if(stops[b].parentStation){d=stopIndex[stops[b].parentStation]}if(!c[d]){a.push(stops[d].myName);c[d]=true}}}$("#startStation").autocomplete({source:a,select:function(e,f){changeStartId(stopName2id[f.item.value])},focus:function(e,f){stops[stopName2id[f.item.value]].circle.openPopup()}});if(debug_mode){console.log("Finished createControls!")}}function initMapControls(){highLightedPath=L.polyline([stops[1]],{clickable:false,color:"#7E1ED0",opacity:1}).addTo(network);transitionMarkers=[];for(var a=0;a<stops.length;a++){if(stops[a].circle&&((stops[a].parentStation=="")&&withOnlyParentStations)||(stops[a].isActive&&(!withOnlyParentStations))){stops[a].circle.on("click",function(c){newId=c.target.id;changeStartId(newId);$("#startStation").val(stops[startId].name)});stops[a].circle.on("contextmenu",function(c){map.scrollWheelZoom.disable();affStopInfo(c.target.id)});stops[a].circle.on("mouseover",function(f){var g=stops[startId].name;var d=getPath(f.target.id);var c="<h4>Station "+stops[f.target.id].name+" : "+Math.floor(60*(arrivalTime[f.target.id]-startHour))+" minutes</h4>";c=c+'<table class="pathDescription">\n<tr><th>'+real2hour(startHour)+"</th><th>"+g+"</th></tr>\n";c=c+pathDescription(d,g);c=c+"</table>\n";info.update(c);highLightPath(d)});stops[a].circle.on("mouseout",function(c){highLightedPath.setLatLngs([stops[startId]]);for(a in transitionMarkers){map.removeLayer(transitionMarkers[a])}transitionMarkers=[];info.update()})}}isActiveRoute=new Array(routes.length);activeRouteSpans=new Array(routes.length);for(var a=0;a<routes.length;a++){var b=$('<span class="routeCheck" id="'+a+'">'+routes[a].shortName+"</>").css({"background-color":activeRouteCheckColor});b.click(function(){if(!basicMode){toggleRouteActivity($(this).attr("id"))}});b.on("contextmenu",function(c){c.preventDefault();c.stopPropagation();affRouteInfo($(this).attr("id"))});b.on("mouseover",function(d){var f=$(this).attr("id");for(var c in routes[f].subRoutes){shapes[subRoutes[routes[f].subRoutes[c]].shapeId].polyline.fireEvent("mouseover")}});b.on("mouseout",function(d){var f=$(this).attr("id");for(var c in routes[f].subRoutes){shapes[subRoutes[routes[f].subRoutes[c]].shapeId].polyline.fireEvent("mouseout")}});$("#activeRoutes").append(b);activeRouteSpans[a]=b;isActiveRoute[a]=true}startApp()}function changeStartId(a){startId=a;startMarker.setLatLng(stops[startId]);computeShortestPath();drawAccessible()}function startApp(){readDate();startHour=$("#slider-hour-vertical").slider("value");maxMinute=$("#slider-minute-vertical").slider("value");setMapInteractions();computeShortestPath();drawAccessible();map.spin(false)}function changeMaxMinute(a){maxMinute=$("#slider-minute-vertical").slider("value");if(debug_mode){console.log("maxMinute : "+maxMinute+"\n")}drawAccessible()}function changeStartHour(a,b){startHour=Number(b.value);$("#startHour").val(real2hour(startHour));if(debug_mode){console.log("startHour : "+startHour+"\n")}computeShortestPath();drawAccessible()}function changeDate(a){readDate();computeShortestPath();drawAccessible()}function setMapInteractions(){info=L.control();info.onAdd=function(c){div=L.DomUtil.create("div","info");this.update();return div};info.update=function(c){div.innerHTML=c||"S&eacute;lectionnez la station de d&eacute;part<br/>puis survolez la station d'arriv√©e"};info.addTo(map);lineInfo=L.control({position:"bottomright"});lineInfo.onAdd=function(c){divLine=L.DomUtil.create("div","lineInfo");this.update();return divLine};lineInfo.update=function(c){divLine.innerHTML=c||"Clic droit pour avoir les horaires de la ligne ou le passage au stop"};lineInfo.addTo(map);var a=new Array;for(var b=0;b<subRoutes.length;b++){if(!a[shapes[subRoutes[b].shapeId].polyline._leaflet_id]){shapes[subRoutes[b].shapeId].polyline.on({contextmenu:function(c){affRouteInfo(subRoutes[c.target.subRouteId].routeId)},click:function(c){if(!basicMode){toggleRouteActivity(subRoutes[c.target.subRouteId].routeId)}},mouseover:highlightRoute,mouseout:resetHighlightRoute});a[shapes[subRoutes[b].shapeId].polyline._leaflet_id]=1}}}function pathDescription(c,a){s="";a=a||"";for(var b in c){if(stops[c[b].stopId].name!=a){s+="<tr><td></td><td class=path_line_number>";if(c[b].subRouteId>=0){if(routes[subRoutes[c[b].subRouteId].routeId].type==3){s+='<img class=path_route_image src="images/bus.png"">'}else{s+='<img class=path_route_image src="images/metro.png"">'}s+=routes[subRoutes[c[b].subRouteId].routeId].shortName+"&nbsp;"}else{s+='<img class=path_route_image src="images/walk.png"">'}s+="</tr><tr><td>"+real2hour(arrivalTime[c[b].stopId])+"</td>";s+="<td>"+stops[c[b].stopId].name+"</td></tr>\n";a=stops[c[b].stopId].name}}return(s)}function changeAnimationVelocity(a,b){sleepDelay=1000*Math.exp(-5/100*Number(b.value));if(debug_mode){console.log("sleepDelay : "+sleepDelay+"\n")}};